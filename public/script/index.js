Array.prototype.remove=function(t){var o=this.indexOf(t);-1!=o&&this.splice(o,1)},angular.module("app",["ngRoute","cp.ngConfirm"]).config(["$routeProvider",function(t){t.otherwise("home")}]).run(["$ngConfirmDefaults",function(t){t.theme="supervan"}]),angular.module("app").value("ServerApiUrl",{save:"/server/save",list:"/server/list",del:"/server/del",request:"/server/request"}).service("ServerApi",["$http","ServerApiUrl",function(t,o){this.save=function(n){return t.post(o.save,n)},this.del=function(n){return t.post(o.del+"/"+n)},this.list=function(){return t.get(o.list)},this.request=function(n){return t.post(o.request+"/"+n)}}]),angular.module("app").value("SshApiUrl",{logList:"/ssh/log/list",logTail:"/ssh/log/tail",tomactStart:"/ssh/tomcat/start"}).service("SshApi",["$http","SshApiUrl",function(t,o){this.logList=function(n){return t.post(o.logList+"/"+n)},this.logTail=function(n,e){return t.post(o.logTail+"/"+n+"/"+e)},this.tomactStart=function(n){return t.post(o.tomactStart+"/"+n)}}]),angular.module("app").config(["$routeProvider",function(t){t.when("/home",{templateUrl:"/temp/core/home/html/ng.home.html",controller:"homeCtrl"}).when("/log/list/:id",{templateUrl:"/temp/core/home/html/ng.log.list.html",controller:"logListCtrl"}).when("/log/tail/:id/:log",{templateUrl:"/temp/core/home/html/ng.log.tail.html",controller:"logTailCtrl"})}]),angular.module("app").controller("homeCtrl",["$scope","$ngConfirm","ServerApi","SshApi",function(t,o,n,e){t.list=[];var l={list:{},set:function(t,o,n){l.list[t.id+o]=n},get:function(t,o){return l.list[t.id+o]}};t.req=l.get,n.list().then(function(o){t.list=o.data,angular.forEach(t.list,function(t){angular.forEach(t.urlList,function(o){n.request(t.domain+o).then(function(n){l.set(t,o,n.data)})})})}),t.tomactStart=function(t){e.tomactStart(t.id)},t.getLogList=function(t){o({title:t.name+"日志列表",contentUrl:"/temp/core/home/html/ng.home.log.list.html",columnClass:"col-md-12",onScopeReady:function(n){var l=this;e.logList(t.id).then(function(t){n.list=t.data}),n.tailLog=function(n){var e;o({title:t.name+"日志列表",content:'<pre class="log-tail">{{ log }}</pre>',columnClass:"col-md-12",onScopeReady:function(o){o.log="",e=io(),e.on("connect",function(){console.log(e.id),e.emit(e.id,JSON.stringify([t.id,n])),e.on(e.id,function(t){o.$apply(function(){o.log+=t})})})},onDestroy:function(){e&&e.close()}}),l.close()}}})},t.showReqDetail=function(t,n){o({title:"["+t.domain+n+"]请求",content:'<pre style="color: #000; text-align: left;">{{ json }}</pre>',columnClass:"col-md-12",onScopeReady:function(o){o.json=JSON.stringify(l.get(t,n),null,4)}})},t.getDomain=function(t){return/^http/.test(t)?t:"http://"+t},t.del=function(e){o({title:"删除",content:"是否删除"+e.name+"?",buttons:{ok:{text:"删除",btnClass:"btn-danger",action:function(){n.del(e.id).then(function(){t.list.remove(e)})}},n:{text:"取消"}}})},t.addOrEdit=function(e){o({title:(e?"编辑":"新增")+"服务器",contentUrl:"/temp/core/home/html/ng.home.server.add.html",columnClass:"col-md-6 col-md-offset-3",onScopeReady:function(t){t.form=angular.extend({},e||{})},buttons:{ok:{text:"保存",btnClass:"btn-info",action:function(o){var l=this;return console.log(o.form),n.save(o.form).then(function(n){e?angular.extend(e,o.form):t.list.push(n.data),l.close()}),!1}},canel:{text:"取消"}}})}}]),angular.module("app").controller("logListCtrl",["$scope","SshApi","$routeParams",function(t,o,n){t.id=n.id,o.logList(n.id).then(function(o){t.list=o.data})}]),angular.module("app").controller("logTailCtrl",["$scope","$routeParams",function(t,o){t.log="",socket=io(),socket.on("connect",function(){socket.emit(socket.id,JSON.stringify([o.id,o.log])),socket.on(socket.id,function(o){t.$apply(function(){t.log+=o,document.body.scrollTop=document.body.offsetHeight+document.body.scrollTop})})})}]),angular.bootstrap(document,["app"]);